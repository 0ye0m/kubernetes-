#!/bin/bash
set -e	
set -o pipefail

TOOLBOX_DOCKER_IMAGE=vish/toolbox
TOOLBOX_DOCKER_TAG=v1
TOOLBOX_USER=root

function gc {
    /home/kubernetes/bin/rkt gc --grace-period=0s &> /dev/null
}

# Garbage collect old rkt containers on exit
trap gc EXIT

/home/kubernetes/bin/rkt run --stage1-name="coreos.com/rkt/stage1-fly:1.16.0" \
	--insecure-options=image \
	--volume=klet,kind=host,source=/var/lib/kubelet,readOnly=false,recursive=true \
	--mount volume=klet,target=/var/lib/kubelet \
	docker://${TOOLBOX_DOCKER_IMAGE}:${TOOLBOX_DOCKER_TAG} --user=${TOOLBOX_USER} --exec /bin/mount -- "$@"
